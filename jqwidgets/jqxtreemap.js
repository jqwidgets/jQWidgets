/*
jQWidgets v5.0.0 (2017-Aug)
Copyright (c) 2011-2017 jQWidgets.
License: http://jqwidgets.com/license/
*/
!function(e){function t(e,t,r,a,n,o,i,l){this.label=e,this.value=t,this.parent=r,this.children=a,this.area=n||null,this.color=o,this.data=i,this.record=l}e.jqx.jqxWidget("jqxTreeMap","",{});var r={};r.default=function(){function e(t,r,a,n){this.height=n,this.width=a,this.xoffset=t,this.yoffset=r,this.shortestEdge=function(){return Math.min(this.height,this.width)},this.getCoordinates=function(e){var t=[],r=this.xoffset,a=this.yoffset,n=h(e)/this.height,o=h(e)/this.width;if(this.width>=this.height)for(i=0;i<e.length;i+=1)t.push([r,a,r+n,a+e[i]/n]),a+=e[i]/n;else for(var i=0;i<e.length;i+=1)t.push([r,a,r+e[i]/o,a+o]),r+=e[i]/o;return t},this.cutArea=function(t){var r;if(this.width>=this.height){var a=t/this.height,n=this.width-a;r=new e(this.xoffset+a,this.yoffset,n,this.height)}else{var o=t/this.width,i=this.height-o;r=new e(this.xoffset,this.yoffset+o,this.width,i)}return r}}function t(e,t){for(var r=[],a=t/h(e),n=0;n<e.length;n+=1)r[n]=e[n]*a;return r}function r(e,t,n,o,i){o=void 0===o?0:o,i=void 0===i?0:i;var l,h=[],u=[];if(s(e[0])){for(c=0;c<e.length;c+=1)h[c]=d(e[c]);l=a(h,t,n,o,i);for(var c=0;c<e.length;c+=1)u.push(r(e[c],l[c][2]-l[c][0],l[c][3]-l[c][1],l[c][0],l[c][1]))}else u=a(e,t,n,o,i);return u}function a(r,a,i,l,s){return l=void 0===l?0:l,s=void 0===s?0:s,n(o(t(r,a*i),[],new e(l,s,a,i),[]))}function n(e){for(var t=[],r=0;r<e.length;r+=1)for(var a=0;a<e[r].length;a+=1)t.push(e[r][a]);return t}function o(e,t,r,a){var n,l,s;{if(0!==e.length)return n=r.shortestEdge(),l=e[0],i(t,l,n)?(t.push(l),o(e.slice(1),t,r,a)):(s=r.cutArea(h(t),a),a.push(r.getCoordinates(t)),o(e,[],s,a)),a;a.push(r.getCoordinates(t))}}function i(e,t,r){var a;return 0===e.length||((a=e.slice()).push(t),l(e,r)>=l(a,r))}function l(e,t){var r=Math.min.apply(Math,e),a=Math.max.apply(Math,e),n=h(e);return Math.max(Math.pow(t,2)*a/Math.pow(n,2),Math.pow(n,2)/(Math.pow(t,2)*r))}function s(e){return e&&e.constructor===Array}function h(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t}function d(e){var t=0;if(s(e[0]))for(var r=0;r<e.length;r+=1)t+=d(e[r]);else t=h(e);return t}return r}();var a={HORIZONTAL:0,VERTICAL:1,BOTH:2};e.extend(e.jqx._jqxTreeMap.prototype,{defineInstance:function(){var t={width:600,height:600,renderCallbacks:{},legendScaleCallback:function(e){return e},hoverEnabled:!1,selectionEnabled:!0,singleSelection:!0,showLegend:!0,legendLabel:"Legend",headerHeight:25,colorRange:100,layout:"default",source:[],displayMember:null,valueMember:null,colorMode:"parent",baseColor:"#C2EEFF",legendPosition:{x:0,y:0},colorRanges:[{color:"#aa9988",min:0,max:10},{color:"#ccbbcc",min:11,max:50},{color:"#000",min:50,max:100}],_root:[]};return this===e.jqx._jqxTreeMap.prototype?t:(e.extend(!0,this,t),t)},createInstance:function(){this.render()},render:function(){this.host.addClass(this.toThemeProperty("jqx-widget")),this._destroy(),this._root=new t(void 0,0,null,[],this.host);var a=function(e,t){for(var a,n={},o=null,i=0;i<e.length;i+=1)if(e[i].items){o=!0;break}var l=new Array;if(o){var s=function(e,t){for(var r=0;r<e.length;r+=1){if(e[r].parent=t,e[r].data||(e[r].data=e[r].value),null==e[r].value&&(e[r].value=0),isNaN(parseFloat(e[r].value))){for(var a=e[r].value.toString(),n="",o=0;o<a.length;o++){var i=a.substring(o,o+1);null==i.match(/^[0-9]+$/)&&"."!=i||(n+=i)}e[r].value=new Number(n)}else e[r].value=parseFloat(e[r].value);l.push(e[r]),e[r].items&&s(e[r].items,e[r].label)}};s(e,null),e=l}for(i=0;i<e.length;i+=1)(a=e[i]).value&&null!=a.parent&&(n[a.parent]||(n[a.parent]=0),n[a.parent]+=a.value);for(i=0;i<e.length;i+=1)void 0!==n[(a=e[i]).label]&&(a.value=n[a.label]);t._buildTree(e,t._root),t._dataList=t._buildList(),t._setStyles();var h=r.default;"simple"===t.layout&&(h=r.simple),t._render(t._root,h),t._renderLegend()};e.jqx.dataAdapter&&null!=this.source&&this.source._source?this.dataBind(this.source,a):(a(this.source,this),this._trigger("bindingComplete"))},dataBind:function(t,r){this.records=new Array;var a=!!t._source,n=new e.jqx.dataAdapter(t,{autoBind:!1});a&&(n=t,t=t._source);var o=function(e,t){e.records=n.records;for(var a=new Array,o=0;o<e.records.length;o++){var i=e.records[o];e.displayMember&&(i.label=i[e.displayMember]),e.valueMember&&(i.value=i[e.valueMember]),i.record=i,a.push(i)}e._trigger("bindingComplete"),r(a,e)};void 0!=t.type&&(n._options.type=t.type),void 0!=t.formatdata&&(n._options.formatData=t.formatdata),void 0!=t.contenttype&&(n._options.contentType=t.contenttype),void 0!=t.async&&(n._options.async=t.async);var i=this;switch(t.datatype){case"local":case"array":default:null!=t.localdata&&(n.unbindBindingUpdate(this.element.id),n.dataBind(),o(this),n.bindBindingUpdate(this.element.id,function(e){o(i)}));break;case"json":case"jsonp":case"xml":case"xhtml":case"script":case"text":case"csv":case"tab":if(null!=t.localdata)return n.unbindBindingUpdate(this.element.id),n.dataBind(),o(this),void n.bindBindingUpdate(this.element.id,function(){o(i)});var l={};n._options.data?e.extend(n._options.data,l):(t.data&&e.extend(l,t.data),n._options.data=l);n.unbindDownloadComplete(i.element.id),n.bindDownloadComplete(i.element.id,function(){o(i)}),n.dataBind()}},_destroy:function(){this.host.children().remove()},destroy:function(){this.host.remove()},refresh:function(e){e||this._refresh()},_refresh:function(){this.render()},_setStyles:function(){this.host.css({position:"relative",width:this.width,height:this.height});null!=this.width&&this.width.toString().indexOf("%"),null!=this.height&&this.height.toString().indexOf("%");var t=this;e.jqx.utilities.resize(this.host,function(){t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t.performLayout()},50)})},resize:function(e,t){this.width=e,this.height=t,this.performLayout()},performLayout:function(){var e=r.default;this.clearSelection(),this._layout(this._root,e)},_getValues:function(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e[r].value);return t},_isColor:function(e){if(!e)return!1;var t=this._colorEvaluator;return!(!t._isRgb(e)&&!t._isHex(e))},_colorEvaluator:{_toRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},_toHex:function(e){var t=e.r.toString(16),r=e.g.toString(16),a=e.b.toString(16);return t=1===t.length?"0"+t:t,r=1===r.length?"0"+r:r,a=1===a.length?"0"+a:a,"#"+t+r+a},_isRgb:function(e){return/(rgb|rgba)\s*\(\s*\d+\s*(,\s*\d+\s*){2}(,\d+\.\d+)?\)(;?)/i.test(e)},_isHex:function(e){return/^(#([0-9A-F]{3})([0-9A-F]{3})?)$/i.test(e)},getColorByValue:function(e,t,r){var a,n,o,i,t,l=this._colorEvaluator;l._isRgb(r)&&(r=l._toHex(r)),r=l._toRgb(r),o=t.length,a=-1/0;for(var s=0;s<o;s+=1)a<t[s].value&&(a=t[s].value);return n=e/a,i=Math.round(n*this.colorRange),l._toHex({r:Math.max(r.r-i,0),g:Math.max(r.g-i,0),b:Math.max(r.b-i,0)})},parent:function(e){var t=e.parent.color,r=this._colorEvaluator;return e.parent?(t||(t=this.baseColor),t=r.getColorByValue.call(this,e.value,e.parent.children,t),e.color=t,t):"#fff"},autoColors:function(e){var t=this.baseColor;return t=this._colorEvaluator.getColorByValue.call(this,e.value,this._dataList,t),e.color=t,t},rangeColors:function(e){for(var t,r=e.value,a=0;a<this.colorRanges.length;a+=1)if((t=this.colorRanges[a]).min<r&&t.max>=r)return t.color;return"#fff"}},_getColor:function(e){var t=e.color,r=this.colorMode;if(this._isColor(t))return t;if("function"==typeof this._colorEvaluator[r])return this._colorEvaluator[r].call(this,e);throw"Invalid colorMode"},_renderRect:function(t,r){var a=e("<div/>"),n=t[2]-t[0],o=t[3]-t[1],i=this._getColor(r);a.css({position:"absolute",left:t[0]-1,top:t[1]-1,width:n,height:o,backgroundColor:i}),a.addClass(this.toThemeProperty("jqx-treemap-rectangle"));var l=this._colorEvaluator,s={data:r.data,label:r.label,value:r.value,parent:r.parent,record:r.record,color:i,rgb:l._toRgb(i)};if(r.parent==this._root&&(s.parent=null),"function"==typeof this.renderCallbacks["*"]&&void 0!==this.renderCallbacks["*"](a,s))return a;if("function"==typeof this.renderCallbacks[r.label])this.renderCallbacks[r.label](a,s);else{n=a.width()-2;a.html('<span style="max-width:'+n+'px;" class="jqx-treemap-label">'+r.label+"</span>")}return a},_centerLabel:function(e,t){var r=e[0].firstChild;r.style.position="absolute",t!==a.HORIZONTAL&&t!==a.BOTH||(r.style.left=(e[0].offsetWidth-r.offsetWidth)/2+"px"),t!==a.VERTICAL&&t!==a.BOTH||(r.style.top=(e[0].offsetHeight-r.offsetHeight)/2+"px")},_trigger:function(t,r){var a=e.Event(t);return a.args=r,this.host.trigger(a)},_addHandlers:function(t,r){var a=this;t.on("mouseenter",function(e){a.hoverEnabled&&(a.host.find(".jqx-treemap-rectangle").removeClass("jqx-treemap-rectangle-hover"),t.addClass(a.toThemeProperty("jqx-treemap-rectangle-hover"))),a._trigger("mouseenterSector",r)}),t.on("mouseleave",function(e){a.hoverEnabled&&t.removeClass("jqx-treemap-rectangle-hover"),a._trigger("mouseleaveSector",r)}),t.on("click",function(r){if(a.selectionEnabled){var n=e.data(this,"jqx-treemap-selected")||!1;a.singleSelection&&a.host.find(".jqx-treemap-rectangle-hover").each(function(t,r){e.data(r,"jqx-treemap-selected",!1),e(r).removeClass("jqx-treemap-rectangle-hover")}),n?(t.removeClass("jqx-treemap-rectangle-hover"),n=!1):(t.addClass(a.toThemeProperty("jqx-treemap-rectangle-hover")),n=!0),e.data(this,"jqx-treemap-selected",n),r.stopImmediatePropagation()}})},clearSelection:function(){this.host.find(".jqx-treemap-rectangle-hover").removeClass(this.toThemeProperty("jqx-treemap-rectangle-hover")),e.data(this,"jqx-treemap-selected",!1)},_layoutArea:function(e,t){e.children.length&&e.children.length>0?(this._centerLabel(t,a.HORIZONTAL),t.addClass(this.toThemeProperty("jqx-treemap-rectangle-parent"))):this._centerLabel(t,a.BOTH)},_render:function(e,t){if(e.children.length){var r=0;e.value&&(r=this.headerHeight);for(var a,n,o=this._getValues(e.children),i=(e.area.offset(),t(o,e.area.width(),e.area.height()-r,0,r)),l=0;l<e.children.length;l+=1)a=e.children[l],n=this._renderRect(i[l],a),a.area=n,e.area.append(n),this._addHandlers(n,{label:a.label,value:a.value,color:a.color,sector:a.area,data:a.data}),this._layoutArea(a,n),this._render(a,t)}},_layout:function(t,r){if(t.children.length){var a=0;t.value&&(a=this.headerHeight);for(var n=this._getValues(t.children),o=(t.area.offset(),r(n,t.area.width(),t.area.height()-a,0,a)),i=0;i<t.children.length;i+=1){var l=t.children[i];this._layoutRect(o[i],l),this._layoutArea(l,l.area),this._layout(l,r)}this.showLegend&&(e(".jqx-treemap-legend").remove(),this._renderLegend())}},_layoutRect:function(e,t){var r=t.area,a=e[2]-e[0],n=e[3]-e[1];r.css({left:e[0]-1,top:e[1]-1,width:a,height:n});var o=this._colorEvaluator,i=this._getColor(t),l={data:t.data,label:t.label,value:t.value,parent:t.parent,record:t.record,color:i,rgb:o._toRgb(i)};if(t.parent==this._root&&(l.parent=null),"function"==typeof this.renderCallbacks["*"]&&void 0!==this.renderCallbacks["*"](r,l))return r;if("function"==typeof this.renderCallbacks[t.label])this.renderCallbacks[t.label](r,l);else{a=r.width()-2;r.find(".jqx-treemap-label:first").css("max-width",a)}},_getBoundValues:function(){var e,t=this._root,r=[],a={},n={};for(a.value=t.value||1/0,n.value=t.value||-1/0,r.push(t);r.length;){e=r.pop(),a.value>e.value&&(a=e),n.value<e.value&&(n=e);for(var o=0;o<e.children.length;o+=1)r.push(e.children[o])}return[a,n]},_getAutocolorRanges:function(){for(var e,t=this._getBoundValues(),r=t[1].value,a=t[0].value,n=(r-a)/5,o=[],i=a;i<r;i+=n)e=Math.round(i),o.push({min:e,max:i+n,color:this._colorEvaluator.getColorByValue.call(this,e,this._dataList,this.baseColor)});return o},_renderLegend:function(){if(/autoColors|rangeColors/.test(this.colorMode)&&this.showLegend){var e=this.colorRanges;"autoColors"===this.colorMode&&(e=this._getAutocolorRanges());var t=this._renderColorLegend(e);this._renderLegendLabel(t)}},_renderLegendLabel:function(t){var r=e('<tr><td colspan="'+t.find("td").length/2+'"/></tr>'),a=e('<div class="'+this.toThemeProperty("jqx-treemap-legend-label")+'" />');a.text(this.legendLabel),r.children().append(a),t.prepend(r)},_renderColorLegend:function(t){var r,a,n=e('<div class="'+this.toThemeProperty("jqx-treemap-legend")+'"/>'),o=function(e){return e};"function"==typeof this.legendScaleCallback&&(o=this.legendScaleCallback);var i=e('<table class="'+this.toThemeProperty("jqx-treemap-legend-table")+'"/>');n.append(i),i.append("<tr/>"),n.append("<div/>"),this.host.append(n),r=e(n.find("tr")[0]),(a=e(n.find("div")[0])).addClass(this.toThemeProperty("jqx-treemap-legend-values"));t.sort(function(e,t){try{if(e.min<t.min)return-1;if(e.min>t.min)return 1}catch(e){}return 0});for(var l=Math.round(n.width()/t.length),s=-2,h=0,d=0;d<t.length;d+=1){var u=e('<td class="'+this.toThemeProperty("jqx-treemap-legend-color")+'"/>');u.css("backgroundColor",t[d].color),r.append(u),0===d&&((c=e('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>')).text(o(t[d].min)),a.append(c),i.css("margin-left",c.width()/2),h=s+=c.width()/2);var c=e('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>');s+=l,c.text(o(t[d].max)),a.append(c),d==t.length-1&&(h+=c.width()/2,n.css("padding-right",h+5),s-=2),s-=c.width()/2,c.css("left",s),s+=c.width()/2}return n.css({position:"absolute",left:this.legendPosition.x,bottom:this.legendPosition.y,visibility:this.showLegend?"visible":"hidden"}),n},_buildTree:function(e,r){var a,n,o=null,i=[];for(i.push(r);i.length;){o=i.pop();for(var l=0;l<e.length;l+=1)if((n=e[l]).parent===o.label||!n.parent&&!o.label){var s=o;a=new t(n.label,parseFloat(n.value,10),s,[],null,n.color,n.data,n.record),o.children.push(a),i.push(a)}}return r},_buildList:function(){var e,t=[],r=[];for(r.push(this._root);r.length;){(e=r.pop())!==this._root&&t.push(e);for(var a=0;a<e.children.length;a+=1)r.push(e.children[a])}return t},propertyChangedHandler:function(e,t,r){"renderCallbacks"!==t&&(/hoverEnabled|selectionEnabled/.test(t)?r||this.host.find("jqx-treemap-rectangle-hover"):"showLegend"===t?this.host.find("jqx-treemap-legend").toggle():this._refresh())}})}(jqxBaseFramework);

